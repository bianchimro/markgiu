(function(a){a.fn.formset=function(c){var n=a.extend({},a.fn.formset.defaults,c),j=n.extraClasses.join(" "),l=a(this),g=l.parent(),b=function(p,o){if(n.extraClasses){p.removeClass(j);p.addClass(n.extraClasses[o%n.extraClasses.length])}},m=function(r,s,p){var o=new RegExp("("+s+"-\\d+-)"),q=s+"-"+p+"-";if(r.attr("for")){r.attr("for",r.attr("for").replace(o,q))}if(r.attr("id")){r.attr("id",r.attr("id").replace(o,q))}if(r.attr("name")){r.attr("name",r.attr("name").replace(o,q))}},f=function(o){return o.find("input,select,textarea,label").length>0},e=function(o){if(o.is("TR")){o.children(":last").append('<a class="'+n.deleteCssClass+'" href="javascript:void(0)">'+n.deleteText+"</a>")}else{if(o.is("UL")||o.is("OL")){o.append('<li><a class="'+n.deleteCssClass+'" href="javascript:void(0)">'+n.deleteText+"</a></li>")}else{o.append('<a class="'+n.deleteCssClass+'" href="javascript:void(0)">'+n.deleteText+"</a>")}}o.find("a."+n.deleteCssClass).click(function(){var t=a(this).parents("."+n.formCssClass),p=t.find('input:hidden[id $= "-DELETE"]');if(n.beforeremove){n.beforeremove(t)}if(p.length){p.val("on");t.hide()}else{t.remove();var q=a("."+n.formCssClass).not(".formset-custom-template");a("#id_"+n.prefix+"-TOTAL_FORMS").val(q.length);for(var r=0,s=q.length;r<s;r++){b(q.eq(r),r);q.eq(r).find("input,select,textarea,label").each(function(){m(a(this),n.prefix,r)})}}k();if(n.removed){n.removed(t)}return false})},k=function(){var o=parseInt(a("#id_"+n.prefix+"-MAX_NUM_FORMS").val()),p=g.find("."+n.formCssClass).length;if(n.min_num>0){if(p<=n.min_num){g.find("."+n.deleteCssClass).hide()}else{g.find("."+n.deleteCssClass+":gt("+(n.min_num-1)+")").show()}}if(o>0){if(p>=o){g.find("."+n.addCssClass).hide()}else{g.find("."+n.addCssClass).show()}}};l.each(function(p){var q=a(this),o=q.find('input:checkbox[id $= "-DELETE"]');if(o.length){o.before('<input type="hidden" name="'+o.attr("name")+'" id="'+o.attr("id")+'" />');o.remove()}if(f(q)){e(q);q.addClass(n.formCssClass);b(q,p)}k()});if(l.length){var h,i;if(n.formTemplate){i=(n.formTemplate instanceof a)?n.formTemplate:a(n.formTemplate);i.removeAttr("id").addClass(n.formCssClass).addClass("formset-custom-template");i.find("input,select,textarea,label").each(function(){m(a(this),n.prefix,2012)});e(i)}else{i=a("."+n.formCssClass+":last").clone(true).removeAttr("id");i.find('input:hidden[id $= "-DELETE"]').remove();i.find("input,select,textarea,label").each(function(){var o=a(this);if(o.is("input:checkbox")||o.is("input:radio")){o.attr("checked",false)}else{o.val("")}})}n.formTemplate=i;if(l.attr("tagName")=="TR"){var d=l.eq(0).children().length;l.parent().append('<tr><td colspan="'+d+'"><a class="'+n.addCssClass+'" href="javascript:void(0)">'+n.addText+"</a></tr>");h=l.parent().find("tr:last a");h.parents("tr").addClass(n.formCssClass+"-add")}else{l.filter(":last").after('<a class="'+n.addCssClass+'" href="javascript:void(0)">'+n.addText+"</a>");h=l.filter(":last").next()}h.click(function(){var p=parseInt(a("#id_"+n.prefix+"-TOTAL_FORMS").val()),q=n.formTemplate.clone(true).removeClass("formset-custom-template"),o=a(this).parents("tr."+n.formCssClass+"-add").get(0)||this;b(q,p);if(n.beforeadd){n.beforeadd(q)}q.insertBefore(a(o)).show();q.find("input,select,textarea,label").each(function(){var r=a(this);m(r,n.prefix,p);if(r.is("input:checkbox")||r.is("input:radio")){r.attr("checked",false)}else{r.val("")}});a("#id_"+n.prefix+"-TOTAL_FORMS").val(p+1);k();if(n.added){n.added(q)}return false});k()}return l};a.fn.formset.defaults={prefix:"form",min_num:0,formTemplate:null,addText:"add another",deleteText:"remove",addCssClass:"add-row",deleteCssClass:"delete-row",formCssClass:"dynamic-form",extraClasses:[],beforeadd:null,added:null,beforeremove:null,removed:null}})(jQuery);